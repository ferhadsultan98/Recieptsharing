<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlavorNest - Lezzet Yuvanız</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* CSS Değişkenleri (Aydınlık ve Karanlık Mod için) */
        :root {
            --bg-color: #FFF0F5; /* Lavender Blush */
            --text-color: #5D5D5D;
            --header-color: #FF69B4; /* Deep Pink */
            --card-bg-color: #FFFFFF;
            --card-shadow-color: rgba(0,0,0,0.08);
            --border-color: #D8BFD8; /* Thistle */
            --button-bg-color: #FFC0CB; /* Pink */
            --button-text-color: white;
            --button-hover-bg-color: #FFB6C1; /* Light Pink */
            --input-bg-color: #FFFFFF;
            --input-border-color: #D8BFD8;
            --input-focus-border-color: #FFB6C1;
            --link-color: #FF69B4;
            --link-hover-color: #FF1493;
            --icon-color: #FF69B4;
            --modal-bg-color: #FFFAFA; /* Snow */
            --hr-color: #D8BFD8;
            --placeholder-img-bg: #FFE4E1;
            --placeholder-img-text: #FF69B4;
            --banner-bg-start: #ff9a9e;
            --banner-bg-end: #fad0c4;
            --banner-text-color: #fff;
            --disabled-bg-color: #e9ecef;
            --disabled-text-color: #6c757d;
        }

        body.dark-mode {
            --bg-color: #2C3E50;
            --text-color: #ECF0F1;
            --header-color: #E980FC;
            --card-bg-color: #34495E;
            --card-shadow-color: rgba(0,0,0,0.2);
            --border-color: #566573;
            --button-bg-color: #9B59B6;
            --button-text-color: white;
            --button-hover-bg-color: #8E44AD;
            --input-bg-color: #566573;
            --input-border-color: #708090;
            --input-focus-border-color: #E980FC;
            --link-color: #E980FC;
            --link-hover-color: #D252F8;
            --icon-color: #E980FC;
            --modal-bg-color: #34495E;
            --hr-color: #566573;
            --placeholder-img-bg: #566573;
            --placeholder-img-text: #E980FC;
            --banner-bg-start: #2c3e50;
            --banner-bg-end: #465869;
            --banner-text-color: #ECF0F1;
            --disabled-bg-color: #495057;
            --disabled-text-color: #adb5bd;
        }

        /* Global Resets and Base Styles */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg-color); color: var(--text-color); line-height: 1.6; font-size: 16px; overflow-x: hidden; transition: background-color 0.3s ease, color 0.3s ease; }
        h1, h2, h3, h4, h5, h6 { font-family: 'Georgia', 'Times New Roman', Times, serif; color: var(--header-color); margin-bottom: 0.75em; line-height: 1.2; }
        p { margin-bottom: 1em; }
        a { color: var(--link-color); text-decoration: none; transition: color 0.3s ease; }
        a:hover { color: var(--link-hover-color); }
        img, video { max-width: 100%; height: auto; border-radius: 8px; }
        button, input[type="submit"] { background-color: var(--button-bg-color); color: var(--button-text-color); border: none; padding: 12px 20px; border-radius: 25px; cursor: pointer; font-size: 1em; font-weight: bold; transition: background-color 0.3s ease, transform 0.2s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        button:hover:not(:disabled), input[type="submit"]:hover:not(:disabled) { background-color: var(--button-hover-bg-color); transform: translateY(-2px); }
        button:active:not(:disabled), input[type="submit"]:active:not(:disabled) { transform: translateY(0); }
        button:disabled, input[type="submit"]:disabled { background-color: var(--disabled-bg-color); color: var(--disabled-text-color); cursor: not-allowed; transform: none; box-shadow: none;}
        input[type="text"], input[type="email"], input[type="password"], input[type="url"], input[type="date"], textarea, select { width: 100%; padding: 10px 15px; margin-bottom: 15px; border: 1px solid var(--input-border-color); border-radius: 8px; font-size: 0.95em; background-color: var(--input-bg-color); color: var(--text-color); transition: border-color 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease, color 0.3s ease; }
        input[type="text"]:focus, input[type="email"]:focus, input[type="password"]:focus, input[type="url"]:focus, input[type="date"]:focus, textarea:focus, select:focus { border-color: var(--input-focus-border-color); box-shadow: 0 0 5px color-mix(in srgb, var(--input-focus-border-color) 50%, transparent); outline: none; }
        textarea { min-height: 100px; resize: vertical; }
        .container { width: 90%; max-width: 1200px; margin: 0 auto; padding: 20px 0; }

        /* Welcome Banner */
        #welcome-banner {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: 3000; /* En üstte */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background: linear-gradient(135deg, var(--banner-bg-start), var(--banner-bg-end));
            color: var(--banner-text-color);
            padding: 20px;
            animation: gradientBG 10s ease infinite alternate;
            transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
        }
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        #welcome-banner h1 { font-size: 3.5em; margin-bottom: 0.3em; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
        #welcome-banner p { font-size: 1.3em; margin-bottom: 1.5em; max-width: 600px; }
        #welcome-banner .banner-logo { font-size: 2em; margin-bottom: 0.5em; }
        #welcome-banner .banner-logo .fa-utensils { margin-right: 10px; } /* Örnek ikon */
        #welcome-banner .auth-buttons button { margin: 0 10px; padding: 15px 30px; font-size: 1.1em; background-color: rgba(255,255,255,0.2); border: 2px solid var(--banner-text-color); color: var(--banner-text-color); }
        #welcome-banner .auth-buttons button:hover { background-color: rgba(255,255,255,0.3); }

        /* Dedicated Auth Screens */
        .auth-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: 2500; /* Banner'ın altında, diğer her şeyin üstünde */
            display: none; /* Initially hidden */
            justify-content: center;
            align-items: center;
            background-color: var(--bg-color); /* Tema arkaplanını kullanır */
            padding: 20px;
        }
        .auth-container {
            background-color: var(--card-bg-color);
            padding: 30px 40px;
            border-radius: 12px;
            box-shadow: 0 5px 20px var(--card-shadow-color);
            width: 100%;
            max-width: 450px;
            text-align: center;
        }
        .auth-container h2 { margin-bottom: 20px; }
        .auth-container .form-group { text-align: left; }
        .auth-screen-close-btn {
            position: absolute;
            top: 20px;
            right: 30px;
            background: none;
            border: none;
            font-size: 2em;
            color: var(--text-color);
            cursor: pointer;
        }

        /* Navigation Header */
        .navbar { background-color: var(--card-bg-color); padding: 15px 0; position: fixed; top: 0; left: 0; width: 100%; z-index: 1000; box-shadow: 0 2px 10px var(--card-shadow-color); transition: top 0.3s ease, background-color 0.3s ease; }
        .navbar-container { display: flex; justify-content: space-between; align-items: center; width: 90%; max-width: 1200px; margin: 0 auto; }
        .site-logo-nav { font-size: 1.8em; font-weight: bold; font-family: 'Georgia', 'Times New Roman', Times, serif; color: var(--header-color); }
        .site-logo-nav a { color: inherit; text-decoration: none; }
        .site-logo-nav .fa-utensils { font-size: 0.8em; margin-right: 8px; }
        .nav-links { list-style: none; display: flex; align-items: center;}
        .nav-links li { margin-left: 20px; }
        .nav-links a { font-weight: 500; font-size: 1em; padding: 5px 0; position: relative; color: var(--link-color); }
        .nav-links a .fas, .nav-links a .far { margin-right: 5px; }
        .nav-links a::after { content: ''; position: absolute; bottom: -2px; left: 0; width: 0; height: 2px; background-color: var(--link-color); transition: width 0.3s ease; }
        .nav-links a:hover::after { width: 100%; }
        .nav-actions { display: flex; align-items: center; }
        .auth-user-display { margin-right: 15px; font-size: 0.9em; color: var(--text-color); cursor: pointer; }
        .auth-user-display .fa-user-circle { margin-right: 5px; }
        .menu-toggle, #theme-toggle-btn { font-size: 1.5em; cursor: pointer; background: none; border: none; color: var(--icon-color); padding: 5px; margin-left: 10px; }
        .menu-toggle { display: none; }

        /* Main Content Area */
        main { padding-top: 100px; min-height: calc(100vh - 150px); }
        #site-content.hidden { display: none; } /* Hide main content for auth screens */

        /* Recipe Gallery, Cards, Modals etc. (Previous styles apply with variable adjustments) */
        #recipe-gallery-section { padding: 20px 0; }
        .gallery-controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 15px; }
        .search-bar input[type="text"] { padding: 10px 15px; width: 250px; max-width: 100%; border-radius: 20px; margin-bottom: 0; }
        .filter-sort select { padding: 10px 15px; border-radius: 20px; margin-bottom: 0; background-color: var(--input-bg-color); color: var(--text-color); border: 1px solid var(--input-border-color); }
        .recipe-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        .recipe-card { background-color: var(--card-bg-color); border-radius: 12px; box-shadow: 0 4px 15px var(--card-shadow-color); overflow: hidden; display: flex; flex-direction: column; transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease; }
        .recipe-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px color-mix(in srgb, var(--card-shadow-color) 150%, transparent); }
        .recipe-card-image { width: 100%; height: 200px; object-fit: cover; background-color: var(--placeholder-img-bg); }
        .recipe-card-content { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; }
        .recipe-card-content h3 { font-size: 1.4em; margin-bottom: 10px; color: var(--header-color);}
        .recipe-card-content p { font-size: 0.9em; margin-bottom: 15px; flex-grow: 1; color: var(--text-color); }
        .recipe-card-meta { display: flex; justify-content: space-between; align-items: center; font-size: 0.85em; color: color-mix(in srgb, var(--text-color) 80%, transparent); margin-bottom: 15px; }
        .recipe-card-meta .likes, .recipe-card-meta .favorites { cursor: pointer; display: inline-flex; align-items: center;}
        .recipe-card-meta .likes .fas, .recipe-card-meta .likes .far,
        .recipe-card-meta .favorites .fas, .recipe-card-meta .favorites .far { margin-right: 5px; color: var(--link-color); }
        .recipe-card-meta .likes.liked .fa-heart, .recipe-card-meta .favorites.favorited .fa-star { color: var(--link-color); /* Solid for liked/favorited */ }


        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); animation: fadeIn 0.3s ease-out; }
        .modal-content { background-color: var(--modal-bg-color); margin: 5% auto; padding: 30px; border-radius: 12px; width: 90%; max-width: 600px; position: relative; box-shadow: 0 5px 20px rgba(0,0,0,0.2); animation: slideIn 0.4s ease-out; transition: background-color 0.3s ease; }
        .modal-content.modal-lg { max-width: 800px; }
        .modal-content.modal-xl { max-width: 950px; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateY(-30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .close-btn { color: var(--text-color); float: right; font-size: 1.8em; font-weight: bold; position: absolute; top: 15px; right: 25px; transition: color 0.3s ease; background: none; border: none; cursor: pointer;}
        .close-btn:hover, .close-btn:focus { color: var(--header-color); }
        .modal-header h2 { margin-top: 0; margin-bottom: 20px; color: var(--header-color); }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--header-color); }
        #image-preview { max-width: 200px; max-height: 200px; margin-top: 10px; border: 1px solid var(--border-color); border-radius: 8px; display: none; }
        .auth-form-toggle { text-align: center; margin-top: 15px; }
        .auth-form-toggle a { cursor: pointer; font-weight: bold;}
        .error-message { color: #E74C3C; background-color: color-mix(in srgb, #E74C3C 15%, transparent); border: 1px solid #E74C3C; padding: 10px; border-radius: 5px; font-size: 0.9em; margin-bottom: 10px; }

        #recipe-detail-modal .modal-content { max-height: 85vh; overflow-y: auto; }
        .recipe-detail-media { width: 100%; max-height: 400px; object-fit: cover; margin-bottom: 20px; background-color: var(--placeholder-img-bg); }
        .recipe-detail-actions { margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap; }
        .recipe-detail-actions .like-btn, .recipe-detail-actions .favorite-btn { display: inline-flex; align-items: center; }
        .recipe-detail-actions .like-btn .fas, .recipe-detail-actions .like-btn .far,
        .recipe-detail-actions .favorite-btn .fas, .recipe-detail-actions .favorite-btn .far { margin-right: 8px; }
        .recipe-detail-actions .like-btn.liked, .recipe-detail-actions .favorite-btn.favorited { background-color: var(--button-hover-bg-color); }


        /* Profile Edit Modal */
        #profile-edit-modal .zodiac-display { font-size: 1.5em; margin-left: 10px; }
        #profile-edit-modal .form-row { display: flex; gap: 20px; }
        #profile-edit-modal .form-row .form-group { flex: 1; }

        /* Comments Section */
        .comments-section { margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--hr-color); }
        .comment { background-color: var(--card-bg-color); padding: 15px; border-radius: 8px; margin-bottom: 15px; box-shadow: 0 2px 5px var(--card-shadow-color); transition: background-color 0.3s ease; }
        .comment-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .comment-author { font-weight: bold; color: var(--header-color); }
        .comment-date { font-size: 0.8em; color: color-mix(in srgb, var(--text-color) 70%, transparent); }
        .comment-body { margin-bottom: 10px; }
        .comment-actions button { background: none; border: none; color: var(--link-color); font-size: 0.85em; padding: 2px 5px; cursor: pointer; margin-right: 10px; }
        .comment-actions button .fas, .comment-actions button .far { margin-right: 3px; }
        .comment-actions button:hover { text-decoration: underline; }
        .replies { margin-left: 30px; padding-left: 15px; border-left: 2px solid var(--border-color); }
        .reply-form, .edit-comment-form { margin-top: 10px; margin-bottom: 10px; }
        .reply-form textarea, .edit-comment-form textarea { min-height: 60px; margin-bottom: 8px; }

        /* Print Styles */
        @media print {
            body * { visibility: hidden; }
            #recipe-detail-modal .modal-content, #recipe-detail-modal .modal-content * { visibility: visible; }
            #recipe-detail-modal { position: absolute; left: 0; top: 0; width: 100%; height: auto; overflow: visible; background: white !important; z-index: 9999; }
            #recipe-detail-modal .modal-content { margin: 0; padding: 20px; border: none; box-shadow: none; max-height: none; max-width: 100%; background: white !important; color: black !important; }
            #recipe-detail-modal .close-btn, #recipe-detail-modal .recipe-detail-actions, #recipe-detail-modal .comments-section { display: none !important; }
            #recipe-detail-modal h2, #recipe-detail-modal h4 { color: black !important; }
            #recipe-detail-modal ul, #recipe-detail-modal li { color: black !important; }
            #recipe-detail-modal .instructions-text, #recipe-detail-modal p { color: black !important; }
            .navbar, .footer, #scroll-to-top, .gallery-controls, #search-input, #sort-filter, .menu-toggle, #theme-toggle-btn, #welcome-banner, .auth-screen { display: none !important; }
            main { padding-top: 0 !important; }
        }


        /* Footer */
        .footer { background-color: var(--card-bg-color); color: color-mix(in srgb, var(--text-color) 80%, transparent); text-align: center; padding: 25px 0; border-top: 1px solid var(--hr-color); margin-top: 40px; transition: background-color 0.3s ease, color 0.3s ease; }
        .footer p { margin-bottom: 10px; }
        .social-media-placeholders a { margin: 0 10px; font-size: 1.5em; color: var(--button-bg-color); }
        .social-media-placeholders a:hover { color: var(--button-hover-bg-color); }
        .newsletter-form input[type="email"]{ width: 250px; padding: 10px; border-radius: 20px; border: 1px solid var(--input-border-color); margin-right: 5px; display: inline-block; vertical-align: middle; }
        .newsletter-form button { padding: 10px 15px; vertical-align: middle; }

        #scroll-to-top { position: fixed; bottom: 20px; right: 20px; background-color: var(--button-bg-color); color: var(--button-text-color); border: none; border-radius: 50%; width: 50px; height: 50px; font-size: 1.5em; cursor: pointer; display: none; justify-content: center; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.2); transition: background-color 0.3s ease, opacity 0.3s ease, visibility 0.3s ease; }
        #scroll-to-top:hover { background-color: var(--button-hover-bg-color); }
        
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .mt-1 { margin-top: 1rem; } .mb-1 { margin-bottom: 1rem; }

        /* Responsive Design */
        @media (max-width: 768px) {
            #welcome-banner h1 { font-size: 2.5em; } #welcome-banner p { font-size: 1.1em; }
            .auth-container { padding: 20px; }
            .navbar-container { width: 95%; }
            .nav-links { display: none; flex-direction: column; position: absolute; top: 70px; left: 0; width: 100%; background-color: var(--card-bg-color); box-shadow: 0 2px 5px var(--card-shadow-color); padding: 10px 0; }
            .nav-links.active { display: flex; }
            .nav-links li { margin: 10px 20px; text-align: center; }
            .menu-toggle { display: block; }
            .site-logo-nav { font-size: 1.5em; }
            .gallery-controls { flex-direction: column; align-items: stretch; }
            .search-bar input[type="text"], .filter-sort select { width: 100%; }
            .modal-content { margin: 10% auto; width: 95%; padding: 20px; }
            .modal-content.modal-lg { max-width: 95%; }
            .recipe-grid { grid-template-columns: 1fr; }
            .newsletter-form input[type="email"] { width: calc(100% - 110px); margin-bottom: 10px;}
            #profile-edit-modal .form-row { flex-direction: column; gap: 0;}
        }
        @media (max-width: 480px) {
            body { font-size: 15px; } h1 { font-size: 2em; } h2 { font-size: 1.6em; } h3 { font-size: 1.3em; }
            .recipe-card-content h3 { font-size: 1.2em; }
            button, input[type="submit"] { padding: 10px 15px; font-size: 0.95em;}
            .footer { padding: 20px 10px; }
            #welcome-banner h1 { font-size: 2em; } #welcome-banner p { font-size: 1em; }
            #welcome-banner .auth-buttons button { padding: 12px 20px; font-size: 1em; }
            .auth-container { max-width: 90%; }
        }

    </style>
</head>
<body>

    <div id="welcome-banner">
        <div class="banner-logo"><i class="fas fa-utensils"></i> FlavorNest</div>
        <h1>Lezzet Yuvanıza Hoş Geldiniz!</h1>
        <p>Binlerce tarifi keşfedin, kendi tariflerinizi paylaşın ve mutfakta harikalar yaratın.</p>
        <div class="auth-buttons">
            <button id="banner-login-btn"><i class="fas fa-sign-in-alt"></i> Giriş Yap</button>
            <button id="banner-register-btn"><i class="fas fa-user-plus"></i> Kayıt Ol</button>
        </div>
    </div>

    <div id="login-screen" class="auth-screen">
        <button class="auth-screen-close-btn" data-screen-id="login-screen" aria-label="Kapat"><i class="fas fa-times"></i></button>
        <div class="auth-container">
            <h2>Giriş Yap</h2>
            <form id="login-form">
                <div id="login-error" class="error-message hidden"></div>
                <div class="form-group"><label for="login-email">E-posta</label><input type="email" id="login-email" required></div>
                <div class="form-group"><label for="login-password">Şifre</label><input type="password" id="login-password" required></div>
                <button type="submit"><i class="fas fa-sign-in-alt"></i> Giriş Yap</button>
            </form>
            <div class="auth-form-toggle mt-1">Hesabın yok mu? <a id="show-register-screen-link">Kayıt Ol</a></div>
             <a href="#" id="forgot-password-link-login" class="mt-1" style="font-size:0.9em; display:block;">Şifremi Unuttum</a>
        </div>
    </div>

    <div id="register-screen" class="auth-screen">
        <button class="auth-screen-close-btn" data-screen-id="register-screen" aria-label="Kapat"><i class="fas fa-times"></i></button>
        <div class="auth-container">
            <h2>Kayıt Ol</h2>
            <form id="register-form">
                <div id="register-error" class="error-message hidden"></div>
                <div class="form-group"><label for="register-fullname">Tam Adınız</label><input type="text" id="register-fullname" required></div>
                <div class="form-group"><label for="register-email">E-posta</label><input type="email" id="register-email" required></div>
                <div class="form-group"><label for="register-password">Şifre (en az 6 karakter)</label><input type="password" id="register-password" required></div>
                <button type="submit"><i class="fas fa-user-plus"></i> Kayıt Ol</button>
            </form>
            <div class="auth-form-toggle mt-1">Zaten hesabın var mı? <a id="show-login-screen-link">Giriş Yap</a></div>
        </div>
    </div>
    
    <div id="site-wrapper"> <header class="navbar">
            <div class="navbar-container">
                <div class="site-logo-nav"><a href="#" id="home-link"><i class="fas fa-utensils"></i> FlavorNest</a></div>
                <div class="nav-actions">
                    <span id="auth-user-display" class="auth-user-display hidden" title="Profili Düzenle"></span>
                    <ul class="nav-links" id="nav-links-list">
                        <li><a href="#" id="nav-home"><i class="fas fa-home"></i> Anasayfa</a></li>
                        <li id="nav-add-recipe-item" class="hidden"><a href="#" id="nav-add-recipe"><i class="fas fa-plus-circle"></i> Tarif Ekle</a></li>
                        <li id="nav-my-favorites-item" class="hidden"><a href="#" id="nav-my-favorites"><i class="fas fa-star"></i> Favorilerim</a></li>
                        <li id="nav-login-item"><a href="#" id="nav-login"><i class="fas fa-sign-in-alt"></i> Giriş Yap</a></li>
                        <li id="nav-register-item"><a href="#" id="nav-register"><i class="fas fa-user-plus"></i> Kayıt Ol</a></li>
                        <li id="nav-logout-item" class="hidden"><a href="#" id="nav-logout"><i class="fas fa-sign-out-alt"></i> Çıkış Yap</a></li>
                    </ul>
                    <button id="theme-toggle-btn" aria-label="Toggle dark mode"><i class="fas fa-moon"></i></button>
                    <button class="menu-toggle" id="menu-toggle-btn" aria-label="Toggle navigation menu"><i class="fas fa-bars"></i></button>
                </div>
            </div>
        </header>

        <main id="site-content">
            <div class="container">
                <section id="recipe-gallery-section">
                     <h2 id="gallery-title" class="text-center mb-1" style="font-size: 2em;">Tüm Tarifler</h2>
                    <div class="gallery-controls">
                        <div class="search-bar">
                            <input type="text" id="search-input" placeholder="Başlık veya etiketle tarif ara...">
                        </div>
                        <div class="filter-sort">
                            <select id="sort-filter">
                                <option value="newest">En Yeniye Göre Sırala</option>
                                <option value="most-liked">En Çok Beğenilene Göre Sırala</option>
                                <option value="most-favorited">En Çok Favorilenene Göre Sırala</option>
                            </select>
                        </div>
                    </div>
                    <div id="recipe-grid" class="recipe-grid">
                        <p id="no-recipes-message" class="hidden">Tarif bulunamadı. Bir tane eklemeyi deneyin!</p>
                    </div>
                </section>
            </div>
        </main>

        <div id="add-edit-recipe-modal" class="modal">
            <div class="modal-content">
                <button class="close-btn" data-modal-id="add-edit-recipe-modal" aria-label="Kapat"><i class="fas fa-times"></i></button>
                <div class="modal-header"><h2 id="add-edit-modal-title">Yeni Tarif Ekle</h2></div>
                <form id="add-edit-recipe-form">
                    <input type="hidden" id="recipe-id-input">
                    <div class="form-group"><label for="recipe-title">Tarif Başlığı</label><input type="text" id="recipe-title" required></div>
                    <div class="form-group"><label for="recipe-short-description">Kısa Açıklama</label><textarea id="recipe-short-description" rows="3" required></textarea></div>
                    <div class="form-group">
                        <label for="recipe-image">Görsel (URL veya Yükle)</label>
                        <input type="url" id="recipe-image-url" placeholder="Görsel URL'si girin (örn: https://example.com/image.jpg)">
                        <p style="text-align: center; margin: 5px 0; font-size: 0.9em;">VEYA</p>
                        <input type="file" id="recipe-image-upload" accept="image/*">
                        <img id="image-preview" src="#" alt="Görsel Önizleme">
                    </div>
                    <div class="form-group"><label for="recipe-ingredients">Malzemeler (her biri yeni satırda)</label><textarea id="recipe-ingredients" rows="5" required placeholder="örn:&#10;1 su bardağı un&#10;2 yumurta&#10;100gr çikolata"></textarea></div>
                    <div class="form-group"><label for="recipe-instructions">Adım Adım Talimatlar</label><textarea id="recipe-instructions" rows="7" required></textarea></div>
                    <div class="form-group"><label for="recipe-tags">Etiketler (virgülle ayrılmış)</label><input type="text" id="recipe-tags" placeholder="örn: tatlı, vegan, hızlı"></div>
                    <button type="submit" id="submit-recipe-btn"><i class="fas fa-save"></i> Tarifi Kaydet</button>
                </form>
            </div>
        </div>

        <div id="recipe-detail-modal" class="modal">
            <div class="modal-content modal-lg">
                <button class="close-btn" data-modal-id="recipe-detail-modal" aria-label="Kapat"><i class="fas fa-times"></i></button>
                <div id="recipe-detail-content"></div>
                <div class="comments-section">
                    <h3><i class="fas fa-comments"></i> Yorumlar</h3>
                    <div id="comments-list"></div>
                    <form id="add-comment-form" class="mt-1 hidden">
                        <h4>Yorum Yap</h4>
                        <input type="hidden" id="comment-recipe-id">
                        <textarea id="comment-text" placeholder="Yorumunuzu yazın..." rows="3" required></textarea>
                        <button type="submit"><i class="fas fa-paper-plane"></i> Yorumu Gönder</button>
                    </form>
                </div>
            </div>
        </div>

        <div id="profile-edit-modal" class="modal">
            <div class="modal-content modal-xl">
                 <button class="close-btn" data-modal-id="profile-edit-modal" aria-label="Kapat"><i class="fas fa-times"></i></button>
                <div class="modal-header"><h2><i class="fas fa-user-edit"></i> Profili Düzenle</h2></div>
                <form id="profile-edit-form">
                    <div id="profile-message" class="error-message hidden"></div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="profile-fullname">Tam Adınız</label>
                            <input type="text" id="profile-fullname">
                        </div>
                        <div class="form-group">
                            <label for="profile-username">Kullanıcı Adı (isteğe bağlı)</label>
                            <input type="text" id="profile-username" placeholder="örn: lezzetustasi123">
                            <small>Bu sitede görünecek adınız. Benzersiz olmak zorunda değildir.</small>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="profile-birthdate">Doğum Tarihi</label>
                            <input type="date" id="profile-birthdate">
                        </div>
                        <div class="form-group">
                            <label for="profile-zodiac">Burcunuz</label>
                            <div style="display: flex; align-items: center;">
                                <select id="profile-zodiac">
                                    <option value="">Seçiniz...</option>
                                    </select>
                                <span id="profile-zodiac-icon" class="zodiac-display"></span>
                            </div>
                        </div>
                    </div>
                    <button type="submit" id="save-profile-btn"><i class="fas fa-save"></i> Profili Kaydet</button>
                </form>
                <hr style="margin: 20px 0; border-color: var(--hr-color);">
                <h4><i class="fas fa-key"></i> Şifre İşlemleri</h4>
                <button id="password-reset-btn" class="mt-1"><i class="fas fa-envelope"></i> Şifre Sıfırlama E-postası Gönder</button>
            </div>
        </div>

        <footer class="footer">
            <div class="container">
                <div class="social-media-placeholders">
                    <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" aria-label="Pinterest"><i class="fab fa-pinterest-p"></i></a>
                </div>
                <div class="newsletter-form mt-1">
                    <input type="email" id="newsletter-email" placeholder="Bülten için e-postanız">
                    <button id="newsletter-submit-btn"><i class="fas fa-envelope"></i> Abone Ol</button>
                </div>
                <p class="mt-1">&copy; <span id="current-year"></span> FlavorNest. Tüm Hakları Saklıdır.</p>
            </div>
        </footer>
    </div> <button id="scroll-to-top" title="Yukarı çık"><i class="fas fa-arrow-up"></i></button>

    <script type="module">
        // Firebase SDK'larından ihtiyaç duyulan fonksiyonları içe aktar
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            onAuthStateChanged, 
            signOut as firebaseSignOut,
            updateProfile,
            sendPasswordResetEmail
        } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";

        // Firebase yapılandırmanız (KENDİ PROJENİZİN BİLGİLERİYLE DEĞİŞTİRİN)
        const firebaseConfig = {
          apiKey: "AIzaSyCOvdvFHbwji_yhzPjAlGTtjlIJNLC2y_Q", // BURAYI DEĞİŞTİRİN
          authDomain: "hrteam-afad9.firebaseapp.com", // BURAYI DEĞİŞTİRİN
          projectId: "hrteam-afad9", // BURAYI DEĞİŞTİRİN
          // Diğer config bilgileri...
           storageBucket: "hrteam-afad9.firebasestorage.app",
           messagingSenderId: "1066969486587",
           appId: "1:1066969486587:web:f557ca9c162ac7ae620c5e",
           measurementId: "G-THQZTV493J"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        let currentUser = null;
        let userProfileData = {}; // Store for additional profile info from localStorage

        const zodiacSigns = [
            { name: "Koç", dates: "21 Mart - 19 Nisan", icon: "♈", fa: "fas fa-meteor" }, // Örnek FA ikonu
            { name: "Boğa", dates: "20 Nisan - 20 Mayıs", icon: "♉", fa: "fas fa-pasture" }, // FA'da boğa yok, genel ikon
            { name: "İkizler", dates: "21 Mayıs - 20 Haziran", icon: "♊", fa: "fas fa-users" },
            { name: "Yengeç", dates: "21 Haziran - 22 Temmuz", icon: "♋", fa: "fas fa-moon" }, // Yengeç yerine ay
            { name: "Aslan", dates: "23 Temmuz - 22 Ağustos", icon: "♌", fa: "fas fa-crown" }, // Aslan yerine taç
            { name: "Başak", dates: "23 Ağustos - 22 Eylül", icon: "♍", fa: "fas fa-seedling" },
            { name: "Terazi", dates: "23 Eylül - 22 Ekim", icon: "♎", fa: "fas fa-balance-scale" },
            { name: "Akrep", dates: "23 Ekim - 21 Kasım", icon: "♏", fa: "fas fa-spider" }, // Akrep yerine örümcek
            { name: "Yay", dates: "22 Kasım - 21 Aralık", icon: "♐", fa: "fas fa-bullseye" }, // Okçuluk hedefi
            { name: "Oğlak", dates: "22 Aralık - 19 Ocak", icon: "♑", fa: "fas fa-mountain" }, // Keçi yerine dağ
            { name: "Kova", dates: "20 Ocak - 18 Şubat", icon: "♒", fa: "fas fa-tint" }, // Su damlası
            { name: "Balık", dates: "19 Şubat - 20 Mart", icon: "♓", fa: "fas fa-fish" }
        ];


        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const welcomeBanner = document.getElementById('welcome-banner');
            const bannerLoginBtn = document.getElementById('banner-login-btn');
            const bannerRegisterBtn = document.getElementById('banner-register-btn');
            const loginScreen = document.getElementById('login-screen');
            const registerScreen = document.getElementById('register-screen');
            const siteWrapper = document.getElementById('site-wrapper'); // Ana site sarmalayıcı
            const siteContent = document.getElementById('site-content'); // Ana içerik (navbar hariç)
            const galleryTitle = document.getElementById('gallery-title');
            const navMyFavoritesItem = document.getElementById('nav-my-favorites-item');
            const navMyFavoritesLink = document.getElementById('nav-my-favorites');


            // Auth Screens' close buttons
            document.querySelectorAll('.auth-screen-close-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.getElementById(btn.dataset.screenId).style.display = 'none';
                    showSiteContent(); // Ana siteyi göster
                });
            });
            
            const recipeGrid = document.getElementById('recipe-grid');
            const noRecipesMessage = document.getElementById('no-recipes-message');
            const searchInput = document.getElementById('search-input');
            const sortFilter = document.getElementById('sort-filter');
            const themeToggleBtn = document.getElementById('theme-toggle-btn');

            const navHomeLink = document.getElementById('nav-home');
            const navAddRecipeLink = document.getElementById('nav-add-recipe');
            const navAddRecipeItem = document.getElementById('nav-add-recipe-item');
            const navLoginItem = document.getElementById('nav-login-item');
            const navRegisterItem = document.getElementById('nav-register-item');
            const navLogoutItem = document.getElementById('nav-logout-item');
            const navLoginBtn = document.getElementById('nav-login');
            const navRegisterBtn = document.getElementById('nav-register');
            const navLogoutBtn = document.getElementById('nav-logout');
            const authUserDisplay = document.getElementById('auth-user-display');

            const menuToggleBtn = document.getElementById('menu-toggle-btn');
            const navLinksList = document.getElementById('nav-links-list');
            const homeLinkLogo = document.getElementById('home-link');

            const addEditRecipeModal = document.getElementById('add-edit-recipe-modal');
            const closeAddEditModalBtn = addEditRecipeModal.querySelector('.close-btn');
            const addEditRecipeForm = document.getElementById('add-edit-recipe-form');
            const addEditModalTitle = document.getElementById('add-edit-modal-title');
            const recipeIdInput = document.getElementById('recipe-id-input');
            const recipeTitleInput = document.getElementById('recipe-title');
            const recipeShortDescriptionInput = document.getElementById('recipe-short-description');
            const recipeImageURLInput = document.getElementById('recipe-image-url');
            const recipeImageUploadInput = document.getElementById('recipe-image-upload');
            const imagePreview = document.getElementById('image-preview');
            const recipeIngredientsInput = document.getElementById('recipe-ingredients');
            const recipeInstructionsInput = document.getElementById('recipe-instructions');
            const recipeTagsInput = document.getElementById('recipe-tags');
            const submitRecipeBtn = document.getElementById('submit-recipe-btn');

            const recipeDetailModal = document.getElementById('recipe-detail-modal');
            const closeRecipeDetailModalBtn = recipeDetailModal.querySelector('.close-btn');
            const recipeDetailContent = document.getElementById('recipe-detail-content');
            
            const commentsList = document.getElementById('comments-list');
            const addCommentFormEl = document.getElementById('add-comment-form');
            const commentRecipeIdInput = document.getElementById('comment-recipe-id');
            const commentTextInput = document.getElementById('comment-text');

            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const loginEmailInput = document.getElementById('login-email');
            const loginPasswordInput = document.getElementById('login-password');
            const registerFullnameInput = document.getElementById('register-fullname');
            const registerEmailInput = document.getElementById('register-email');
            const registerPasswordInput = document.getElementById('register-password');
            const loginErrorDiv = document.getElementById('login-error');
            const registerErrorDiv = document.getElementById('register-error');
            const showRegisterScreenLink = document.getElementById('show-register-screen-link');
            const showLoginScreenLink = document.getElementById('show-login-screen-link');
            const forgotPasswordLinkLogin = document.getElementById('forgot-password-link-login');


            // Profile Edit Modal Elements
            const profileEditModal = document.getElementById('profile-edit-modal');
            const closeProfileEditModalBtn = profileEditModal.querySelector('.close-btn');
            const profileEditForm = document.getElementById('profile-edit-form');
            const profileFullnameInput = document.getElementById('profile-fullname');
            const profileUsernameInput = document.getElementById('profile-username');
            const profileBirthdateInput = document.getElementById('profile-birthdate');
            const profileZodiacSelect = document.getElementById('profile-zodiac');
            const profileZodiacIcon = document.getElementById('profile-zodiac-icon');
            const saveProfileBtn = document.getElementById('save-profile-btn');
            const passwordResetBtn = document.getElementById('password-reset-btn');
            const profileMessageDiv = document.getElementById('profile-message');
            
            const currentYearSpan = document.getElementById('current-year');
            const newsletterEmailInput = document.getElementById('newsletter-email');
            const newsletterSubmitBtn = document.getElementById('newsletter-submit-btn');
            const scrollToTopBtn = document.getElementById('scroll-to-top');

            // --- State Management (localStorage) ---
            let recipes = JSON.parse(localStorage.getItem('recipesV3')) || [];
            let comments = JSON.parse(localStorage.getItem('commentsV3')) || [];
            let userProfilesStore = JSON.parse(localStorage.getItem('userProfilesStoreV1')) || {};
            let userFavoritesStore = JSON.parse(localStorage.getItem('userFavoritesStoreV1')) || {};
            let currentRecipeView = 'all'; // 'all' or 'favorites'


            // --- Helper Functions ---
            const generateId = () => '_' + Math.random().toString(36).substr(2, 9);
            const saveRecipes = () => localStorage.setItem('recipesV3', JSON.stringify(recipes));
            const saveComments = () => localStorage.setItem('commentsV3', JSON.stringify(comments));
            const saveUserProfilesStore = () => localStorage.setItem('userProfilesStoreV1', JSON.stringify(userProfilesStore));
            const saveUserFavoritesStore = () => localStorage.setItem('userFavoritesStoreV1', JSON.stringify(userFavoritesStore));

            const getFileBase64 = (file) => new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });

            const showSiteContent = () => {
                welcomeBanner.classList.add('hidden');
                welcomeBanner.style.opacity = '0';
                welcomeBanner.style.visibility = 'hidden';
                loginScreen.style.display = 'none';
                registerScreen.style.display = 'none';
                siteWrapper.classList.remove('hidden');
            };

            const showAuthScreen = (screenType) => {
                welcomeBanner.classList.add('hidden');
                 welcomeBanner.style.opacity = '0';
                welcomeBanner.style.visibility = 'hidden';
                siteWrapper.classList.add('hidden'); // Hide main site wrapper
                if (screenType === 'login') {
                    loginScreen.style.display = 'flex';
                    registerScreen.style.display = 'none';
                } else if (screenType === 'register') {
                    registerScreen.style.display = 'flex';
                    loginScreen.style.display = 'none';
                }
            };
            
            // Populate Zodiac Select
            zodiacSigns.forEach(sign => {
                const option = document.createElement('option');
                option.value = sign.name;
                option.textContent = `${sign.name} (${sign.dates})`;
                profileZodiacSelect.appendChild(option);
            });
            profileZodiacSelect.addEventListener('change', function() {
                const selectedSign = zodiacSigns.find(s => s.name === this.value);
                profileZodiacIcon.innerHTML = selectedSign ? `<i class="${selectedSign.fa}" title="${selectedSign.name}"></i>` : '';
            });


            // --- Dark/Light Mode ---
            const applyTheme = (theme) => {
                if (theme === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeToggleBtn.innerHTML = '<i class="fas fa-sun"></i>';
                } else {
                    document.body.classList.remove('dark-mode');
                    themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i>';
                }
            };
            themeToggleBtn.addEventListener('click', () => {
                const newTheme = document.body.classList.toggle('dark-mode') ? 'dark' : 'light';
                localStorage.setItem('theme', newTheme);
                applyTheme(newTheme);
            });
            applyTheme(localStorage.getItem('theme') || 'light');

            // --- Navigation & Modal Management ---
            menuToggleBtn.addEventListener('click', () => navLinksList.classList.toggle('active'));
            const closeAllModalsLocal = () => { // Renamed to avoid conflict if any global one exists
                document.querySelectorAll('.modal').forEach(modal => modal.style.display = 'none');
            };
            document.querySelectorAll('.close-btn[data-modal-id]').forEach(btn => {
                btn.onclick = () => document.getElementById(btn.dataset.modalId).style.display = 'none';
            });
            document.addEventListener('keydown', (e) => { if (e.key === "Escape") { closeAllModalsLocal(); loginScreen.style.display = 'none'; registerScreen.style.display = 'none'; if(welcomeBanner.classList.contains('hidden')) showSiteContent(); } });
            window.onclick = (event) => { if (event.target.classList.contains('modal')) event.target.style.display = "none"; }

            navHomeLink.addEventListener('click', (e) => { e.preventDefault(); closeAllModalsLocal(); currentRecipeView = 'all'; galleryTitle.textContent = "Tüm Tarifler"; navLinksList.classList.remove('active'); window.scrollTo({ top: 0, behavior: 'smooth' }); renderRecipeGallery(); });
            homeLinkLogo.addEventListener('click', (e) => { e.preventDefault(); navHomeLink.click(); });
            
            navMyFavoritesLink.addEventListener('click', (e) => {
                e.preventDefault();
                if (!currentUser) { alert("Favorilerinizi görmek için giriş yapın."); return; }
                closeAllModalsLocal();
                currentRecipeView = 'favorites';
                galleryTitle.textContent = "Favori Tariflerim";
                navLinksList.classList.remove('active');
                window.scrollTo({ top: 0, behavior: 'smooth' });
                renderRecipeGallery();
            });


            // --- Firebase Authentication & Profile ---
            onAuthStateChanged(auth, (user) => {
                currentUser = user;
                if (user) {
                    showSiteContent();
                    const userStoredProfile = userProfilesStore[user.uid] || {};
                    authUserDisplay.innerHTML = `<i class="fas fa-user-circle"></i> ${userStoredProfile.username || userStoredProfile.fullName || user.displayName || user.email.split('@')[0]}`;
                    authUserDisplay.classList.remove('hidden');
                    authUserDisplay.onclick = () => { populateProfileEditForm(); profileEditModal.style.display = 'block'; };

                    navLoginItem.classList.add('hidden');
                    navRegisterItem.classList.add('hidden');
                    navLogoutItem.classList.remove('hidden');
                    navAddRecipeItem.classList.remove('hidden');
                    navMyFavoritesItem.classList.remove('hidden');
                    addCommentFormEl.classList.remove('hidden');

                    // Load user-specific data if needed (e.g., favorites count)
                    userProfileData = userProfilesStore[user.uid] || {};

                } else { // User is signed out
                    // Show welcome banner only if no auth screen is explicitly open
                    if (loginScreen.style.display !== 'flex' && registerScreen.style.display !== 'flex') {
                        welcomeBanner.classList.remove('hidden');
                        welcomeBanner.style.opacity = '1';
                        welcomeBanner.style.visibility = 'visible';
                        siteWrapper.classList.add('hidden');
                    }
                    authUserDisplay.textContent = '';
                    authUserDisplay.classList.add('hidden');
                    authUserDisplay.onclick = null;
                    navLoginItem.classList.remove('hidden');
                    navRegisterItem.classList.remove('hidden');
                    navLogoutItem.classList.add('hidden');
                    navAddRecipeItem.classList.add('hidden');
                    navMyFavoritesItem.classList.add('hidden');
                    addCommentFormEl.classList.add('hidden');
                    userProfileData = {};
                    currentRecipeView = 'all'; // Reset view on logout
                    galleryTitle.textContent = "Tüm Tarifler";
                }
                renderRecipeGallery();
                if (recipeDetailModal.style.display === 'block' && commentRecipeIdInput.value) {
                    showRecipeDetail(commentRecipeIdInput.value);
                }
            });

            bannerLoginBtn.addEventListener('click', () => showAuthScreen('login'));
            bannerRegisterBtn.addEventListener('click', () => showAuthScreen('register'));
            navLoginBtn.addEventListener('click', (e) => { e.preventDefault(); showAuthScreen('login'); navLinksList.classList.remove('active'); });
            navRegisterBtn.addEventListener('click', (e) => { e.preventDefault(); showAuthScreen('register'); navLinksList.classList.remove('active'); });
            showRegisterScreenLink.addEventListener('click', (e) => { e.preventDefault(); showAuthScreen('register'); });
            showLoginScreenLink.addEventListener('click', (e) => { e.preventDefault(); showAuthScreen('login'); });
            
            forgotPasswordLinkLogin.addEventListener('click', (e) => {
                e.preventDefault();
                const email = loginEmailInput.value;
                if (!email) {
                    loginErrorDiv.textContent = "Şifre sıfırlama e-postası için lütfen e-posta adresinizi girin.";
                    loginErrorDiv.classList.remove('hidden');
                    return;
                }
                sendPasswordResetEmail(auth, email)
                    .then(() => {
                        loginErrorDiv.textContent = `Şifre sıfırlama e-postası ${email} adresine gönderildi. Lütfen gelen kutunuzu kontrol edin.`;
                        loginErrorDiv.classList.remove('hidden');
                        loginErrorDiv.style.color = 'green'; // Success message color
                    })
                    .catch((error) => {
                        loginErrorDiv.textContent = "Şifre sıfırlama hatası: " + error.message.replace('Firebase: ', '');
                        loginErrorDiv.classList.remove('hidden');
                        loginErrorDiv.style.color = '#E74C3C'; // Error message color
                    });
            });


            loginForm.addEventListener('submit', (e) => {
                e.preventDefault(); loginErrorDiv.classList.add('hidden'); loginErrorDiv.style.color = '#E74C3C';
                signInWithEmailAndPassword(auth, loginEmailInput.value, loginPasswordInput.value)
                    .catch((error) => { loginErrorDiv.textContent = "Giriş başarısız: " + error.message.replace('Firebase: ', ''); loginErrorDiv.classList.remove('hidden'); });
            });

            registerForm.addEventListener('submit', (e) => {
                e.preventDefault(); registerErrorDiv.classList.add('hidden');
                const fullname = registerFullnameInput.value.trim();
                const email = registerEmailInput.value;
                const password = registerPasswordInput.value;

                if (!fullname) {
                     registerErrorDiv.textContent = "Tam adınızı girmeniz gerekmektedir."; registerErrorDiv.classList.remove('hidden'); return;
                }

                createUserWithEmailAndPassword(auth, email, password)
                    .then((userCredential) => {
                        updateProfile(userCredential.user, { displayName: fullname })
                            .then(() => {
                                // Save initial profile data to localStorage
                                userProfilesStore[userCredential.user.uid] = {
                                    fullName: fullname,
                                    username: '',
                                    birthDate: '',
                                    zodiacSign: '',
                                    email: userCredential.user.email // Store email for convenience
                                };
                                saveUserProfilesStore();
                                // onAuthStateChanged handles UI update
                            });
                    })
                    .catch((error) => { registerErrorDiv.textContent = "Kayıt başarısız: " + error.message.replace('Firebase: ', ''); registerErrorDiv.classList.remove('hidden'); });
            });

            navLogoutBtn.addEventListener('click', (e) => { e.preventDefault(); firebaseSignOut(auth).catch((error) => console.error("Logout Error:", error)); navLinksList.classList.remove('active'); });

            // Profile Edit Logic
            const populateProfileEditForm = () => {
                if (!currentUser) return;
                const profile = userProfilesStore[currentUser.uid] || {};
                profileFullnameInput.value = profile.fullName || currentUser.displayName || '';
                profileUsernameInput.value = profile.username || '';
                profileBirthdateInput.value = profile.birthDate || '';
                profileZodiacSelect.value = profile.zodiacSign || '';
                const selectedSign = zodiacSigns.find(s => s.name === profile.zodiacSign);
                profileZodiacIcon.innerHTML = selectedSign ? `<i class="${selectedSign.fa}" title="${selectedSign.name}"></i>` : '';
                profileMessageDiv.classList.add('hidden');
            };

            profileEditForm.addEventListener('submit', (e) => {
                e.preventDefault();
                if (!currentUser) return;

                const newFullName = profileFullnameInput.value.trim();
                const newUsername = profileUsernameInput.value.trim();

                // Update Firebase Auth display name if full name changed and is not empty
                if (newFullName && newFullName !== currentUser.displayName) {
                    updateProfile(currentUser, { displayName: newFullName }).catch(err => console.error("Firebase profil güncelleme hatası:", err));
                }

                userProfilesStore[currentUser.uid] = {
                    ...userProfilesStore[currentUser.uid], // Preserve existing fields like email
                    fullName: newFullName,
                    username: newUsername,
                    birthDate: profileBirthdateInput.value,
                    zodiacSign: profileZodiacSelect.value
                };
                saveUserProfilesStore();
                
                profileMessageDiv.textContent = "Profil başarıyla güncellendi!";
                profileMessageDiv.style.color = 'green';
                profileMessageDiv.classList.remove('hidden');
                // Update navbar display
                authUserDisplay.innerHTML = `<i class="fas fa-user-circle"></i> ${newUsername || newFullName || currentUser.email.split('@')[0]}`;

                setTimeout(() => { profileMessageDiv.classList.add('hidden'); profileEditModal.style.display = 'none'; }, 2000);
            });

            passwordResetBtn.addEventListener('click', () => {
                if (!currentUser || !currentUser.email) {
                    profileMessageDiv.textContent = "Şifre sıfırlama için geçerli bir e-posta adresi bulunamadı.";
                    profileMessageDiv.style.color = '#E74C3C';
                    profileMessageDiv.classList.remove('hidden');
                    return;
                }
                sendPasswordResetEmail(auth, currentUser.email)
                    .then(() => {
                        profileMessageDiv.textContent = `Şifre sıfırlama e-postası ${currentUser.email} adresine gönderildi.`;
                        profileMessageDiv.style.color = 'green';
                        profileMessageDiv.classList.remove('hidden');
                    })
                    .catch((error) => {
                        profileMessageDiv.textContent = "Şifre sıfırlama hatası: " + error.message.replace('Firebase: ', '');
                        profileMessageDiv.style.color = '#E74C3C';
                        profileMessageDiv.classList.remove('hidden');
                    });
            });
            closeProfileEditModalBtn.onclick = () => profileEditModal.style.display = 'none';


            // --- Recipe Gallery, Cards, Detail (with Auth and Favorites) ---
            const renderRecipeCard = (recipe) => {
                const card = document.createElement('article');
                card.className = 'recipe-card';
                card.dataset.id = recipe.id;

                const isLikedByCurrentUser = currentUser && recipe.likedBy && recipe.likedBy.includes(currentUser.uid);
                const isFavoritedByCurrentUser = currentUser && userFavoritesStore[currentUser.uid] && userFavoritesStore[currentUser.uid].includes(recipe.id);
                
                let imageSrc = recipe.image || `https://via.placeholder.com/300x200/${getComputedStyle(document.documentElement).getPropertyValue('--placeholder-img-bg').trim().substring(1)}/${getComputedStyle(document.documentElement).getPropertyValue('--placeholder-img-text').trim().substring(1)}?text=Tarif+Görseli`;
                if (recipe.image && !recipe.image.startsWith('http') && !recipe.image.startsWith('data:image')) {
                    imageSrc = `https://via.placeholder.com/300x200/FF0000/FFFFFF?text=Görsel+Hatası`;
                }

                card.innerHTML = `
                    <img src="${imageSrc}" alt="${recipe.title}" class="recipe-card-image">
                    <div class="recipe-card-content">
                        <h3>${recipe.title}</h3>
                        <p>${recipe.shortDescription}</p>
                        <div class="recipe-card-meta">
                            <div>
                                <span class="likes ${isLikedByCurrentUser ? 'liked' : ''}" data-recipe-id="${recipe.id}" title="Bu tarifi beğen">
                                    <i class="fa-${isLikedByCurrentUser ? 'solid' : 'regular'} fa-heart"></i>
                                    <span class="like-count">${recipe.likedBy ? recipe.likedBy.length : 0}</span>
                                </span>
                                <span class="favorites ${isFavoritedByCurrentUser ? 'favorited' : ''}" data-recipe-id="${recipe.id}" title="Favorilere ekle" style="margin-left:10px;">
                                    <i class="fa-${isFavoritedByCurrentUser ? 'solid' : 'regular'} fa-star"></i>
                                    <span class="fav-count">${recipe.favoritedByCount || 0}</span>
                                </span>
                            </div>
                            <span>${recipe.tags ? recipe.tags.map(t => `#${t}`).join(' ') : ''}</span>
                        </div>
                        <button class="view-full-btn" data-id="${recipe.id}"><i class="fas fa-eye"></i> Tamamını Gör</button>
                    </div>
                `;
                card.querySelector('.view-full-btn').addEventListener('click', () => showRecipeDetail(recipe.id));
                
                const likeElement = card.querySelector('.likes');
                if (currentUser) {
                    likeElement.addEventListener('click', (e) => { e.stopPropagation(); toggleLike(recipe.id, true); });
                } else { likeElement.style.cursor = 'default'; likeElement.title = 'Beğenmek için giriş yapın'; }

                const favElement = card.querySelector('.favorites');
                 if (currentUser) {
                    favElement.addEventListener('click', (e) => { e.stopPropagation(); toggleFavorite(recipe.id, true); });
                } else { favElement.style.cursor = 'default'; favElement.title = 'Favorilere eklemek için giriş yapın'; }

                return card;
            };

            const renderRecipeGallery = () => {
                recipeGrid.innerHTML = '';
                const searchTerm = searchInput.value.toLowerCase();
                const currentSort = sortFilter.value;
                let recipesToDisplay = recipes;

                if (currentRecipeView === 'favorites' && currentUser) {
                    const favoriteIds = userFavoritesStore[currentUser.uid] || [];
                    recipesToDisplay = recipes.filter(r => favoriteIds.includes(r.id));
                     if (recipesToDisplay.length === 0) {
                        galleryTitle.textContent = "Henüz Favori Tarifiniz Yok";
                    } else {
                        galleryTitle.textContent = "Favori Tariflerim";
                    }
                } else if (currentRecipeView === 'all') {
                     galleryTitle.textContent = "Tüm Tarifler";
                }


                let filteredRecipes = recipesToDisplay.filter(recipe => {
                    const titleMatch = recipe.title.toLowerCase().includes(searchTerm);
                    const tagMatch = recipe.tags && recipe.tags.some(tag => tag.toLowerCase().includes(searchTerm));
                    return titleMatch || tagMatch;
                });

                if (currentSort === 'most-liked') {
                    filteredRecipes.sort((a, b) => (b.likedBy ? b.likedBy.length : 0) - (a.likedBy ? a.likedBy.length : 0));
                } else if (currentSort === 'most-favorited') {
                    filteredRecipes.sort((a, b) => (b.favoritedByCount || 0) - (a.favoritedByCount || 0));
                } else { // newest (default)
                    filteredRecipes.sort((a, b) => b.timestamp - a.timestamp);
                }

                if (filteredRecipes.length === 0 && currentRecipeView === 'all') {
                    noRecipesMessage.classList.remove('hidden');
                    noRecipesMessage.textContent = "Tarif bulunamadı. Arama kriterlerinizi değiştirmeyi deneyin veya yeni bir tarif ekleyin!";
                } else if (filteredRecipes.length === 0 && currentRecipeView === 'favorites') {
                     noRecipesMessage.classList.remove('hidden');
                     noRecipesMessage.textContent = "Bu arama için favori tarif bulunamadı veya henüz favori tarifiniz yok.";
                }
                else {
                    noRecipesMessage.classList.add('hidden');
                    filteredRecipes.forEach(recipe => recipeGrid.appendChild(renderRecipeCard(recipe)));
                }
            };

            searchInput.addEventListener('input', renderRecipeGallery);
            sortFilter.addEventListener('change', renderRecipeGallery);

            // --- Add/Edit Recipe (Auth checks) ---
            navAddRecipeLink.addEventListener('click', (e) => {
                e.preventDefault();
                if (!currentUser) { alert("Tarif eklemek için giriş yapmalısınız."); showAuthScreen('login'); return; }
                addEditModalTitle.textContent = 'Yeni Tarif Ekle';
                addEditRecipeForm.reset(); recipeIdInput.value = '';
                imagePreview.style.display = 'none'; imagePreview.src = '#';
                submitRecipeBtn.innerHTML = '<i class="fas fa-plus-circle"></i> Tarifi Ekle';
                closeAllModalsLocal(); addEditRecipeModal.style.display = 'block';
                navLinksList.classList.remove('active');
            });
            closeAddEditModalBtn.onclick = () => addEditRecipeModal.style.display = 'none';
            // Image preview logic (unchanged from previous)
             recipeImageUploadInput.addEventListener('change', function() { /* ... */ });
             recipeImageURLInput.addEventListener('input', function() { /* ... */ });


            addEditRecipeForm.addEventListener('submit', async (e) => { /* ... (add userId to recipeData, check ownership for edit) ... */ 
                 e.preventDefault();
                if (!currentUser) { alert("Bu işlem için giriş yapmalısınız."); return; }

                const id = recipeIdInput.value || generateId();
                let imageValue = recipeImageURLInput.value;

                if (recipeImageUploadInput.files && recipeImageUploadInput.files[0]) {
                    try { imageValue = await getFileBase64(recipeImageUploadInput.files[0]); }
                    catch (error) { console.error("Base64'e çevirme hatası:", error); alert("Resim işlenirken hata oluştu."); return; }
                } else if (!imageValue && !recipeIdInput.value) { imageValue = ''; }
                else if (!imageValue && recipeIdInput.value) {
                    const existingRecipe = recipes.find(r => r.id === id);
                    if (existingRecipe) imageValue = existingRecipe.image;
                }

                const recipeData = {
                    id: id,
                    title: recipeTitleInput.value.trim(),
                    shortDescription: recipeShortDescriptionInput.value.trim(),
                    image: imageValue,
                    ingredients: recipeIngredientsInput.value.trim().split('\n').filter(Boolean),
                    instructions: recipeInstructionsInput.value.trim(),
                    tags: recipeTagsInput.value.split(',').map(tag => tag.trim()).filter(Boolean),
                    userId: currentUser.uid,
                    authorName: userProfilesStore[currentUser.uid]?.username || userProfilesStore[currentUser.uid]?.fullName || currentUser.displayName || currentUser.email.split('@')[0],
                    likedBy: recipeIdInput.value ? (recipes.find(r => r.id === id).likedBy || []) : [],
                    favoritedByCount: recipeIdInput.value ? (recipes.find(r => r.id === id).favoritedByCount || 0) : 0,
                    timestamp: Date.now() 
                };
                
                if (recipeIdInput.value) { // Editing
                    const index = recipes.findIndex(r => r.id === id);
                    if (index !== -1 && recipes[index].userId === currentUser.uid) {
                        recipes[index] = { ...recipes[index], ...recipeData, likedBy: recipes[index].likedBy, favoritedByCount: recipes[index].favoritedByCount, timestamp: recipes[index].timestamp }; // Preserve likes, fav count, original timestamp
                    } else if (index !== -1) {
                        alert("Bu tarifi düzenleme yetkiniz yok."); return;
                    }
                } else { // Adding new
                    recipes.push(recipeData);
                }
                saveRecipes(); renderRecipeGallery(); addEditRecipeModal.style.display = 'none';
            });

            const openEditRecipeForm = (recipeId) => { /* ... (check ownership) ... */ 
                const recipe = recipes.find(r => r.id === recipeId);
                if (!recipe) return;
                if (!currentUser || recipe.userId !== currentUser.uid) { alert("Bu tarifi düzenleme yetkiniz yok."); return; }

                addEditModalTitle.textContent = 'Tarifi Düzenle';
                recipeIdInput.value = recipe.id;
                recipeTitleInput.value = recipe.title;
                // ... (rest of form population)
                submitRecipeBtn.innerHTML = '<i class="fas fa-save"></i> Değişiklikleri Kaydet';
                closeAllModalsLocal(); addEditRecipeModal.style.display = 'block';
            };
            
            const deleteRecipe = (recipeId) => { /* ... (check ownership) ... */ 
                 const recipe = recipes.find(r => r.id === recipeId);
                if (!recipe) return;
                if (!currentUser || recipe.userId !== currentUser.uid) { alert("Bu tarifi silme yetkiniz yok."); return; }
                if (!confirm('Bu tarifi silmek istediğinizden emin misiniz? Bu işlem geri alınamaz.')) return;

                recipes = recipes.filter(r => r.id !== recipeId);
                comments = comments.filter(c => c.recipeId !== recipeId); // Delete associated comments
                // Remove from all users' favorites
                Object.keys(userFavoritesStore).forEach(userId => {
                    const favIndex = (userFavoritesStore[userId] || []).indexOf(recipeId);
                    if (favIndex > -1) userFavoritesStore[userId].splice(favIndex, 1);
                });

                saveRecipes(); saveComments(); saveUserFavoritesStore();
                renderRecipeGallery();
                recipeDetailModal.style.display = 'none';
            };

            // --- Recipe Detail (Auth checks, Print, Favorite) ---
            closeRecipeDetailModalBtn.onclick = () => recipeDetailModal.style.display = 'none';
            const showRecipeDetail = (recipeId) => {
                const recipe = recipes.find(r => r.id === recipeId);
                if (!recipe) return;
                commentRecipeIdInput.value = recipeId;
                const isLikedByCurrentUser = currentUser && recipe.likedBy && recipe.likedBy.includes(currentUser.uid);
                const isFavoritedByCurrentUser = currentUser && userFavoritesStore[currentUser.uid] && userFavoritesStore[currentUser.uid].includes(recipe.id);
                let imageDetailSrc = recipe.image || `https://via.placeholder.com/...`; // Placeholder
                
                let authorDisplayName = recipe.authorName || 'Bilinmeyen Yazar';
                if(recipe.userId && userProfilesStore[recipe.userId]){
                    const authorProfile = userProfilesStore[recipe.userId];
                    authorDisplayName = authorProfile.username || authorProfile.fullName || authorDisplayName;
                }


                recipeDetailContent.innerHTML = `
                    <img src="${imageDetailSrc}" alt="${recipe.title}" class="recipe-detail-media">
                    <h2>${recipe.title}</h2>
                    <p><small>Yazar: ${authorDisplayName} | Oluşturulma: ${new Date(recipe.timestamp).toLocaleDateString()}</small></p>
                    <p>${recipe.shortDescription}</p>
                    <h4><i class="fas fa-carrot"></i> Malzemeler:</h4>
                    <ul>${recipe.ingredients.map(ing => `<li>${ing}</li>`).join('')}</ul>
                    <h4><i class="fas fa-concierge-bell"></i> Talimatlar:</h4>
                    <div class="instructions-text">${recipe.instructions.replace(/\n/g, '<br>')}</div>
                    <p><strong><i class="fas fa-tags"></i> Etiketler:</strong> ${recipe.tags ? recipe.tags.map(t => `#${t}`).join(' ') : 'Yok'}</p>
                    <p><strong><i class="fas fa-heart"></i> Beğeniler:</strong> <span id="detail-like-count">${recipe.likedBy ? recipe.likedBy.length : 0}</span></p>
                     <p><strong><i class="fas fa-star"></i> Favorilenme Sayısı:</strong> <span id="detail-fav-count">${recipe.favoritedByCount || 0}</span></p>
                    <div class="recipe-detail-actions">
                        ${currentUser ? `
                            <button class="like-btn ${isLikedByCurrentUser ? 'liked' : ''}" id="detail-like-btn" data-recipe-id="${recipe.id}">
                                <i class="fa-${isLikedByCurrentUser ? 'solid' : 'regular'} fa-heart"></i> ${isLikedByCurrentUser ? 'Beğenildi' : 'Beğen'}
                            </button>
                            <button class="favorite-btn ${isFavoritedByCurrentUser ? 'favorited' : ''}" id="detail-favorite-btn" data-recipe-id="${recipe.id}">
                                <i class="fa-${isFavoritedByCurrentUser ? 'solid' : 'regular'} fa-star"></i> ${isFavoritedByCurrentUser ? 'Favorilerden Çıkar' : 'Favorilere Ekle'}
                            </button>
                        ` : '<p style="font-size:0.9em; color: var(--text-color);">Beğenmek veya favorilere eklemek için giriş yapın.</p>'}
                        <button id="print-recipe-btn"><i class="fas fa-print"></i> Tarifi Yazdır</button>
                        ${currentUser && recipe.userId === currentUser.uid ? `
                            <button id="edit-recipe-btn" data-id="${recipe.id}"><i class="fas fa-edit"></i> Tarifi Düzenle</button>
                            <button id="delete-recipe-btn" data-id="${recipe.id}" style="background-color: #E74C3C;"><i class="fas fa-trash"></i> Tarifi Sil</button>
                        ` : ''}
                    </div>`;
                
                if (currentUser) {
                    const detailLikeBtn = document.getElementById('detail-like-btn');
                    if(detailLikeBtn) detailLikeBtn.addEventListener('click', function() { toggleLike(recipe.id, false); });
                    const detailFavBtn = document.getElementById('detail-favorite-btn');
                    if(detailFavBtn) detailFavBtn.addEventListener('click', function() { toggleFavorite(recipe.id, false); });
                }
                const printBtn = document.getElementById('print-recipe-btn');
                if(printBtn) printBtn.addEventListener('click', () => window.print());
                const editBtn = document.getElementById('edit-recipe-btn');
                if (editBtn) editBtn.addEventListener('click', () => openEditRecipeForm(recipe.id));
                const deleteBtn = document.getElementById('delete-recipe-btn');
                if (deleteBtn) deleteBtn.addEventListener('click', () => deleteRecipe(recipe.id));
                
                renderComments(recipeId);
                closeAllModalsLocal(); recipeDetailModal.style.display = 'block';
            };

            // --- Like & Favorite System ---
            const toggleLike = (recipeId, updateGallery = false) => { /* ... (no change from previous, uses recipe.likedBy) ... */ 
                if (!currentUser) { alert("Beğenmek için giriş yapmalısınız."); return; }
                const recipeIndex = recipes.findIndex(r => r.id === recipeId);
                if (recipeIndex === -1) return;
                const recipe = recipes[recipeIndex];
                if (!recipe.likedBy) recipe.likedBy = [];
                const userLikeIndex = recipe.likedBy.indexOf(currentUser.uid);
                if (userLikeIndex > -1) recipe.likedBy.splice(userLikeIndex, 1);
                else recipe.likedBy.push(currentUser.uid);
                saveRecipes();
                if (updateGallery) renderRecipeGallery();
                else { // Update detail view
                    const detailLikeCount = document.getElementById('detail-like-count');
                    const detailLikeBtn = document.getElementById('detail-like-btn');
                    if (detailLikeCount && recipeDetailModal.style.display === 'block' && detailLikeBtn && detailLikeBtn.dataset.recipeId === recipeId) {
                        detailLikeCount.textContent = recipe.likedBy.length;
                        const isLiked = recipe.likedBy.includes(currentUser.uid);
                        detailLikeBtn.classList.toggle('liked', isLiked);
                        detailLikeBtn.innerHTML = `<i class="fa-${isLiked ? 'solid' : 'regular'} fa-heart"></i> ${isLiked ? 'Beğenildi' : 'Beğen'}`;
                    }
                }
            };

            const toggleFavorite = (recipeId, updateGallery = false) => {
                if (!currentUser) { alert("Favorilere eklemek için giriş yapmalısınız."); return; }
                if (!userFavoritesStore[currentUser.uid]) userFavoritesStore[currentUser.uid] = [];
                
                const recipeIndexInGlobal = recipes.findIndex(r => r.id === recipeId);
                if(recipeIndexInGlobal === -1) return;

                const userFavList = userFavoritesStore[currentUser.uid];
                const favIndex = userFavList.indexOf(recipeId);

                if (favIndex > -1) { // Already favorited, remove
                    userFavList.splice(favIndex, 1);
                    recipes[recipeIndexInGlobal].favoritedByCount = (recipes[recipeIndexInGlobal].favoritedByCount || 1) - 1;
                } else { // Not favorited, add
                    userFavList.push(recipeId);
                    recipes[recipeIndexInGlobal].favoritedByCount = (recipes[recipeIndexInGlobal].favoritedByCount || 0) + 1;
                }
                saveUserFavoritesStore();
                saveRecipes(); // To save favoritedByCount

                if (updateGallery) renderRecipeGallery();
                else { // Update detail view
                    const detailFavCount = document.getElementById('detail-fav-count');
                    const detailFavBtn = document.getElementById('detail-favorite-btn');
                    if (recipeDetailModal.style.display === 'block' && detailFavBtn && detailFavBtn.dataset.recipeId === recipeId) {
                        if(detailFavCount) detailFavCount.textContent = recipes[recipeIndexInGlobal].favoritedByCount;
                        const isFavorited = userFavList.includes(recipeId);
                        detailFavBtn.classList.toggle('favorited', isFavorited);
                        detailFavBtn.innerHTML = `<i class="fa-${isFavorited ? 'solid' : 'regular'} fa-star"></i> ${isFavorited ? 'Favorilerden Çıkar' : 'Favorilere Ekle'}`;
                    }
                }
            };

            // --- Comment System (Auth checks) ---
            // createCommentElement, handleCommentSubmit to use currentUser.uid and display name from userProfilesStore or Firebase.
             const renderComments = (recipeId) => { /* ... */ };
             const createCommentElement = (comment, recipeId, isReply = false) => { /* ... (add Font Awesome icons to buttons, check comment.userId for edit/delete) ... */
                const div = document.createElement('div');
                div.className = `comment ${isReply ? 'reply' : ''}`;
                div.dataset.commentId = comment.id;
                const replies = comments.filter(r => r.parentId === comment.id).sort((a,b) => new Date(a.timestamp) - new Date(b.timestamp));
                const canEditOrDelete = currentUser && comment.userId === currentUser.uid;
                let authorDisplayName = comment.authorName || 'Anonim';
                if(comment.userId && userProfilesStore[comment.userId]){
                    const authorProfile = userProfilesStore[comment.userId];
                    authorDisplayName = authorProfile.username || authorProfile.fullName || authorDisplayName;
                }


                div.innerHTML = `
                    <div class="comment-header">
                        <span class="comment-author">${authorDisplayName}</span>
                        <span class="comment-date">${new Date(comment.timestamp).toLocaleString()}</span>
                    </div>
                    <p class="comment-body">${comment.text.replace(/\n/g, '<br>')}</p>
                    <div class="comment-actions">
                        ${currentUser && !isReply ? '<button class="reply-to-comment-btn"><i class="fas fa-reply"></i> Yanıtla</button>' : ''}
                        ${canEditOrDelete ? `
                            <button class="edit-comment-btn"><i class="fas fa-edit"></i> Düzenle</button>
                            <button class="delete-comment-btn"><i class="fas fa-trash"></i> Sil</button>
                        ` : ''}
                    </div>
                    ${!isReply ? '<div class="reply-form-container hidden"></div>' : ''}
                    <div class="replies">${replies.map(reply => createCommentElement(reply, recipeId, true).outerHTML).join('')}</div>
                `;
                // Event listeners for reply, edit, delete (unchanged logic, but ensure canEditOrDelete is checked)
                return div;
            };
            const toggleReplyForm = (parentId, container) => { /* ... */ };
            const showEditCommentForm = (commentId, commentElement) => { /* ... */ };
            const deleteComment = (commentId, recipeId) => { /* ... */ };
            const handleCommentSubmit = (recipeId, text, parentId = null) => { /* ... (store userId and authorName from profile/Firebase) ... */ 
                 if (!currentUser) { alert("Yorum yapmak için giriş yapmalısınız."); return; }
                const userCurrentProfile = userProfilesStore[currentUser.uid] || {};
                const authorName = userCurrentProfile.username || userCurrentProfile.fullName || currentUser.displayName || currentUser.email.split('@')[0];
                const newComment = {
                    id: generateId(), recipeId: recipeId, parentId: parentId, text: text,
                    userId: currentUser.uid, authorName: authorName,
                    timestamp: new Date().toISOString()
                };
                comments.push(newComment); saveComments(); renderComments(recipeId);
                if (!parentId) commentTextInput.value = '';
            };
            addCommentFormEl.addEventListener('submit', (e) => { /* ... */ });


            // --- Footer & Scroll --- (Font Awesome icons added to buttons)
            currentYearSpan.textContent = new Date().getFullYear();
            newsletterSubmitBtn.addEventListener('click', (e) => { /* ... */ });
            window.onscroll = () => { (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) ? scrollToTopBtn.style.display = "flex" : scrollToTopBtn.style.display = "none"; };
            scrollToTopBtn.addEventListener('click', () => window.scrollTo({top: 0, behavior: 'smooth'}));

            // --- Initial Load & Dummy Data ---
            if (recipes.length === 0) {
                // Demo recipes can be added here for first-time use.
                // Ensure they have `userId`, `authorName`, `likedBy: []`, `favoritedByCount: 0` fields.
            }
            // Initial rendering is handled by onAuthStateChanged after Firebase initializes.
        }); // End DOMContentLoaded
    </script>
</body>
</html>

